
@{
    ViewData["Title"] = "Searchresult";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div ng-app="MyApp" ng-controller="MyController">
    <section class="mod-search">

        <div class="container">
            <div class="search-box col-12">
                <label class="modirdo">
                    One way
                    <input type="radio" checked="checked" name="radio">
                    <span class="checkmark"></span>
                </label>
                <label class="modirdo">
                    Round Trip
                    <input type="radio" name="radio">
                    <span class="checkmark"></span>
                </label>
                <div class="search-form col-12">
                    <div class="col-md-2 pl-0">
                        <label>
                            From
                            <input type="text" class="fromto" value="Delhi (DEL)">
                        </label>
                        <ul class="airport-ul">
                            <li>
                                <b>Delhi(DEL)</b>
                                <small>Indira Gandhi International Airport,  India </small>
                            </li>
                            <li>
                                <b>Bangalore(BLR)</b>
                                <small>Bengaluru International Airport,  India </small>
                            </li>
                            <li>
                                <b>Mumbai(BOM)</b>
                                <small>Chhatrapati Shivaji International Airport,  India </small>
                            </li>
                            <li>
                                <b>Kolkata(CCU)</b>
                                <small>Netaji Subhash Chandra Bose Airport,  India </small>
                            </li>
                            <li>
                                <b>Goa(GOI)</b>
                                <small>Dabolim Goa International Airport,  India </small>
                            </li>
                        </ul>
                        <script>

                        </script>
                    </div>
                    <div class="col-md-2 pl-0">
                        <label>
                            To
                            <input type="text" class="fromto" value="Mumbai (BOM)">
                        </label>
                    </div>
                    <div class="col-md-2">
                        <label>
                            Departure
                            <input type="text" value="25 Jul,Fri" id="datepicker">
                        </label>
                    </div>
                    <div class="col-md-2">
                        <label>
                            Return
                            <input type="text" value="25 Jul,Fri">
                        </label>
                    </div>
                    <div class="col-md-3">


                        <label>
                            Travellers | Class
                            <input type="text" class="psg-class" value="Economy, 1 Passenger">
                        </label>

                        <div class="passenger-bx">
                            <div class="psg_main_dv">
                                <div class="adl_col"><p>Adult</p><span>(12+ yrs)</span></div>
                                <div class="cnt_col">
                                    <div class="plu-miss">
                                        <div class="mbtn">
                                            <span class="minus_boxADt">-</span>
                                        </div>
                                        <div class="txt">
                                            <input type="text" name="quantity" value="1" readonly="">
                                        </div>
                                        <div class="plbtn">
                                            <span class="plus_box1">+</span>
                                        </div>
                                        <div class="clr"></div>
                                    </div>

                                </div>
                            </div>
                            <div class="psg_main_dv">
                                <div class="adl_col"><p>Child</p><span>(2-12 yrs)</span></div>
                                <div class="cnt_col">
                                    <div class="plu-miss">
                                        <div class="mbtn">
                                            <span class="minus_boxADt">-</span>
                                        </div>
                                        <div class="txt">
                                            <input type="text" name="quantity" value="0" readonly="">
                                        </div>
                                        <div class="plbtn">
                                            <span class="plus_box1">+</span>
                                        </div>
                                        <div class="clr"></div>
                                    </div>

                                </div>
                            </div>
                            <div class="psg_main_dv">
                                <div class="adl_col"><p>Infant</p><span>Before 2 yrs)</span></div>
                                <div class="cnt_col">
                                    <div class="plu-miss">
                                        <div class="mbtn">
                                            <span class="minus_boxADt">-</span>
                                        </div>
                                        <div class="txt">
                                            <input type="text" name="quantity" value="0" readonly="">
                                        </div>
                                        <div class="plbtn">
                                            <span class="plus_box1">+</span>
                                        </div>
                                        <div class="clr"></div>
                                    </div>

                                </div>
                            </div>
                            <div class="psg_main_dv lst">
                                <div class="adl_col"><p>Class</p></div>
                                <div class="cnt_col">
                                    <select>
                                        <option>Economy</option>
                                        <option>Business</option>
                                        <option>First</option>
                                    </select>
                                </div>
                            </div>
                            <button class="psg-done">Done</button>
                        </div>
                    </div>
                    <div class="col-md-1 pl-0 pr-0">
                        <label>
                            &nbsp;
                            <input type="button" value="Search">
                        </label>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <section class="filters">
        <div class="container">
            <div class="col-md-4">
                <label class="modirdo">
                    NON-STOP FLIGHTS ONLY
                    <input type="radio" checked="checked" name="radio">
                    <span class="checkmark"></span>
                </label>
            </div>
            <div class="col-md-8">
                <div class="col-md-2">
                    Filter by
                </div>
                <div class="col-md-2">
                    <select>
                        <option>Stops</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select>
                        <option>Price</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select>
                        <option>Departure</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select>
                        <option>Duration</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <select>
                        <option>Airlines</option>
                    </select>
                </div>
            </div>
        </div>
    </section>
    <section class="result-container">
        <div class="container">
            <div class="col-md-9">
                <div class="select-dep onway col-md-12">
                    <div class="spinner" ng-show="loading">
                        <img src="/images/loading.gif" alt="ajaxload" />
                    </div>
                    <h3><img src="/images/flight-icon.jpg" width="33" /> SELECT DEPARTING FLIGHT</h3>
                    <h4><b>DELHI(DEL) to MUMBAI(BOM)</b> | Friday, 22 July 2021</h4>
                    <div class="result-layer col-md-12 pr-0 pl-0" ng-repeat="flight in Flights.returnId.results[0]">
                        <div class="col-md-2 air-logo">
                            <img src="/images/airlines-logo/{{flight.segment[0].airline.name}}.png" width="45" />
                            <span>{{flight.segment[0].airline.name}} </span>
                            <span>{{flight.segment[0].airline.code}}-{{flight.segment[0].airline.flightNumber}}</span>
                        </div>
                        <div class="col-md-5 air-time">
                            <div class="col-md-4">
                                <b>{{flight.segment[0].departureTime | date:'hh:mm'}}</b>
                                <strong>{{flight.segment[0].origin.cityName}}</strong>
                               
                            </div>
                            <div class="col-md-4 air-duration pl-0 pr-0">
                                <span>

                                    {{diffDate(flight.segment[0].departureTime, flight.segment[flight.segment.length-1].arrivalTime) }}
                                    <small ng-if="flight.segment.length>1"><i></i>{{flight.segment.length-1}}-stop<i></i></small>
                                    <small ng-if="flight.segment.length<=1">non-stop</small>
                                    @*<small ng-if="flight.segment?.length >1"><i></i>{{flight.segment.length-1}}-stop<i></i></small>*@
                                    @*<small *ngIf="flight.segment?.length <= 1"><i></i>non-stop<i></i></small>*@
                                </span>
                            </div>
                            <div class="col-md-4">
                                <b>{{flight.segment[flight.segment.length-1].arrivalTime | date:'hh:mm'}}</b>
                                <strong>{{flight.segment[flight.segment.length-1].destination.cityName}}</strong>
</div>
                        </div>
                        <div class="col-md-3 air-price">
                            <b><i class="fa fa-rupee"></i>{{flight.totalPriceList[0].netFare}}</b>
                        </div>
                        <div class="col-md-2 select-btn">
                            <button>Select</button>
                            <span class="flight-detail-btn">Flight Detail</span>
                        </div>
                        <div class="flight-detail-bx col-md-12">
                            <div class="col-md-3 text-center air-logo">
                                <img src="/images/aa.jpg" width="45" />
                                <span>AirAisa</span>
                                <span>AK-1234</span>
                            </div>
                            <div class="col-md-9 air-time">
                                <div class="col-md-4">
                                    <b>06:50</b>
                                    <strong>Mumbai</strong>
                                </div>
                                <div class="col-md-4 air-duration pl-0 pr-0">
                                    <span>
                                        02h 10m
                                        <small><i></i>non-stop<i></i></small>
                                    </span>
                                </div>
                                <div class="col-md-4">
                                    <b>16:50</b>
                                    <strong>Delhi</strong>
                                </div>
                            </div>
                            <div class="layover col-md-12">LAYOVER: 7h :10m</div>
                            <div class="col-md-3 text-center air-logo">
                                <img src="/images/aa.jpg" width="45" />
                                <span>AirAisa</span>
                                <span>AK-1234</span>
                            </div>
                            <div class="col-md-9 air-time">
                                <div class="col-md-4">
                                    <b>06:50</b>
                                    <strong>Mumbai</strong>
                                </div>
                                <div class="col-md-4 air-duration pl-0 pr-0">
                                    <span>
                                        02h 10m
                                        <small><i></i>non-stop<i></i></small>
                                    </span>
                                </div>
                                <div class="col-md-4">
                                    <b>16:50</b>
                                    <strong>Delhi</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            <div class="col-md-3">
                <img src="/images/hdfc-result-right.jpg" />
            </div>
        </div>
    </section>
    <section class="select-way">
        <div class="container">
            <div class="col-md-12 pl-0 pr-0">
                <div class="col-md-3 total-price">
                    <strong>Total price for all Passengers</strong>
                    <b><i class="fa fa-rupee"></i>4342</b>
                </div>
                <div class="col-md-6 select-way-time">
                    <strong>Selected Departure</strong>
                    <small>6:50 (DEL) - 09:00 (BOM)</small>
                </div>
                <div class="col-md-3 select-btn">
                    <button>Select your return flight</button>
                </div>
            </div>
        </div>
    </section>
</div>
<script type="text/javascript">
    var app = angular.module('MyApp', [])
    app.controller('MyController', function ($scope, $http, $window) {
        var queryString = new Array();
        if ($window.location.search.split('?').length > 1) {
            var params = $window.location.search.split('?')[1].split('&');
            for (var i = 0; i < params.length; i++) {
                var key = params[i].split('=')[0];
                var value = decodeURIComponent(params[i].split('=')[1]);
                queryString[key] = value;
            }
        }
        if (queryString["itinerary"] != null && queryString["ttype"] != null && queryString["paxtype"] != null && queryString["cc"] != null && queryString["fdate"] != null)
        {
            var itinerary = queryString["itinerary"];           
            var from = itinerary.split('-')[0];
            var to = itinerary.split('-')[1];
            var triptype = queryString["ttype"];
            var paxtype = queryString["paxtype"];
            var adult = paxtype.split('_')[0];
            var adultcnt = adult.split('-')[1];
            var child = paxtype.split('_')[1];
            var childcnt = child.split('-')[1];
            var infant = paxtype.split('_')[2];
            var infantcnt = infant.split('-')[1];
            var cabin = queryString["cc"];
            var cc = 2;
            if (cabin == 'Economy') {
                cc = 2;
            }
            else if (cabin == 'Premium Economy') {
                cc = 3;
            }
            else if (cabin == 'Business') {
                cc = 4;
            }
            else {
                cc = 6;
            }
            var fdate = queryString["fdate"];
            var rdate = null;
            var jtype = 1;
            if (triptype == 'r') {
                rdate = queryString["rdate"];
                jtype = 2;
            }

           
            $scope.loading = true;
                var post = $http({
                    method: "POST",
                    url: "http://103.208.201.116:8020/api/air/SearchFlight/VMN",
                    dataType: 'json',
                    data: {
                        "From": from,
                        "To": to,
                        "JourneyType": jtype, //OneWay = 1, Return = 2,
                        "CabinClass": cc, // ECONOMY = 2, PREMIUM_ECONOMY = 3, BUSINESS = 4,FIRST = 6
                        "DepartureDt": fdate,
                        "ReturnDt": rdate,
                        "AdultCount": adultcnt,
                        "ChildCount": childcnt,
                        "InfantCount": infantcnt,
                        "DirectFlight": true},

                });

                post.success(function (data, status) {
                    
                    $scope.Flights = data;
                    $scope.loading = false;
                });

                post.error(function (data, status) {
                    $window.alert(data.Message);
                    $scope.loading = false;
                });
        }
        $scope.diffDate = function (date1, date2) {
            
            var dateout1 = Date.parse(date1, "yyyy-MM-dd HH:mm:ss");
            var dateout2 = Date.parse(date2, "yyyy-MM-dd HH:mm:ss");
           // var dateOut1 = new Date(date1); // it will work if date1 is in ISO format
           // var dateOut2 = new Date(date2);
           // TimeSpan ts=
            var timeDiff = Math.abs(dateout2 - dateout1);
            var seconds = timeDiff / 1000;
            var minutes = seconds / 60;
            var relmin = minutes % 60;
            var hours = Math.floor(minutes / 60);
            hours = hours < 10 ? '0' + hours : hours;
            relmin = relmin < 10 ? '0' + relmin : relmin;
            var days = hours / 24;
           
            var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
            return parseInt(hours) + 'h:' + relmin+'m';
        };
    });
</script>