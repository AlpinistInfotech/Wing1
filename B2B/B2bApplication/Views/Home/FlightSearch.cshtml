@model B2BClasses.Models.mdlFlightSearch
@using B2BClasses.Services.Enums
@{
    ViewData["Title"] = enmDocumentMaster.Flight.GetDocumentDetails().Name;
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<input type="hidden" value="@(enmDocumentMaster.Flight)" id="_currentDocument" name="_currentDocument" />


<form id="frmFlightReview" asp-controller="Home" asp-action="FlightReview" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="FareQuoteRequest.TraceId" value="@(Model.searchResponse?.TraceId??string.Empty)">
    <input type="hidden" id="FareQuoteRequestResultIndex" name="FareQuoteRequest.ResultIndex" value="">
</form>

<div class="row">
    <div class="col-sm-12">
        <div class="widget-box">
            <div class="widget-header">
                <h4 class="widget-title">Search Flight</h4>
            </div>
            <div class="widget-body">
                <div class="widget-main">
                    <form action="@Url.Action()" method="post">
                        @Html.AntiForgeryToken()
                        <div asp-validation-summary="All" class="text-danger"></div>
                        <input type="hidden" asp-for="FlightSearchWraper.CabinClass" />
                        <div class="row">

                            <div class="form-group col-md-3">
                                <label for="Origin">From</label>
                                <div class="row">
                                    <div class="col-sm-11">
                                        <div class="form-group">
                                            <select id="Origin" asp-for="FlightSearchWraper.From" class="select2 form-control" data-placeholder="From">
                                                @foreach (var d in Model.Airports)
                                                {
                                                    <option value="@d.AirportCode">@(d.AirportCode), @d.CityName, @d.CountryCode  </option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="Origin">To</label>
                                <div class="row">
                                    <div class="col-sm-11">
                                        <div class="form-group">
                                            <select id="Origin" asp-for="FlightSearchWraper.To" class="select2 form-control" data-placeholder="To">
                                                @foreach (var d in Model.Airports)
                                                {
                                                    <option value="@d.AirportCode">@(d.AirportCode), @d.CityName, @d.CountryCode </option>
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="id-date-picker-1">Journey Type</label>
                                <div class="row">
                                    <div class="col-sm-11">
                                        <div class="form-group">
                                            <select id="JourneyType" asp-for="FlightSearchWraper.JourneyType" class="form-control" data-placeholder="Journey Type">
                                                <option value="1">OneWay </option>
                                                <option value="2">Return </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-3">
                                <label for="id-date-picker-1">Travel Date</label>
                                <div class="row">
                                    <div class="col-sm-11">
                                        <div class="input-daterange input-group">
                                            <input type="text" class="input-sm form-control" id="DepartureDt" asp-for="FlightSearchWraper.DepartureDt" asp-format="{0:dd-MMM-yyyy}" />
                                            <span class="input-group-addon">
                                                <i class="fa fa-exchange"></i>
                                            </span>
                                            <input type="text" class="input-sm form-control" asp-for="FlightSearchWraper.ReturnDt" asp-format="{0:dd-MMM-yyyy}" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col-md-2">

                                <div class="row">
                                    <label for="Adult" class="col-sm-3">Adult</label>
                                    <div class="col-sm-9">
                                        <div class="form-group">
                                            <select id="Adult" asp-for="FlightSearchWraper.AdultCount" class="form-control" data-placeholder="Adult">
                                                <option value="1">1</option>
                                                <option value="2">2 </option>
                                                <option value="3">3 </option>
                                                <option value="4">4 </option>
                                                <option value="5">5 </option>
                                                <option value="6">6 </option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-2">
                                <div class="row">
                                    <label for="Child" class="col-sm-3">Child</label>
                                    <div class="col-sm-9">
                                        <div class="form-group">
                                            <select id="Child" asp-for="FlightSearchWraper.ChildCount" class="form-control" data-placeholder="Child">
                                                <option value="0">0</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-2">
                                <div class="row">
                                    <label for="Infant" class="col-sm-3">Infant</label>
                                    <div class="col-sm-9">
                                        <div class="form-group">
                                            <select id="Infant" asp-for="FlightSearchWraper.InfantCount" class="form-control" data-placeholder="Infant">
                                                <option value="0">0</option>
                                                <option value="1">1</option>
                                                <option value="2">2</option>
                                                <option value="3">3</option>
                                                <option value="4">4</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group col-md-6">
                                <button class="btn btn-info" type="submit">
                                    <i class="ace-icon fa fa-search bigger-110"></i>
                                    Search
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    @{
        ViewData["JourneyType"] = ((Model.searchResponse?.Results?.Count ?? 0) == 1) ? 1 : 2;
        ViewBag.AdultCount = Model.FlightSearchWraper.AdultCount;
        ViewBag.ChildCount = Model.FlightSearchWraper.ChildCount;
        ViewBag.InfantCount = Model.FlightSearchWraper.InfantCount;
    }

    @if ((Model.searchResponse?.Results?.Count ?? 0) == 1)
    {


        @foreach (var res in Model.searchResponse?.Results.FirstOrDefault())
        {
            <div class="col-md-8 col-md-offset-2 col-sm-12">
                @{ await Html.RenderPartialAsync("_FlightResult", res);}
            </div>
        }
    }

    @if ((Model.searchResponse?.Results?.Count ?? 0) > 1)
    {

<div class="row">
    @{ ViewBag.JourneyType1 = "OnwardRadio"; }
    <div class="col-md-6">
        @foreach (var res in Model.searchResponse?.Results[0])
        {

            <div class="col-sm-12">
                @{ await Html.RenderPartialAsync("_FlightResult", res);}
            </div>
        }
    </div>
    <div class="col-md-6">
        @{ ViewBag.JourneyType1 = "ReturnRadio"; }
        @foreach (var res in Model.searchResponse?.Results[0])
        {

            <div class="col-sm-12">
                @{ await Html.RenderPartialAsync("_FlightResult", res);}
            </div>
        }
    </div>
</div>
    }
</div>

@section Scripts {
    <script>
        jQuery(function ($) {
            $('.select2').select2({ allowClear: true });
            $('.input-daterange').datepicker({ autoclose: true, format: 'd-M-yyyy', startDate: '3d' });
        });


        $(document).ready(function () {
            $("button[name='bookFlight']").click(function () {
                var resultInde = $("input[name='ResultIndex']:checked").val();
                $("#FareQuoteRequestResultIndex").val(resultInde);
                $("#frmFlightReview").submit();
            });
        });

    </script>
}
